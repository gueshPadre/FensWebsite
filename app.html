<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>App â€“ F.E.N.S.</title>
    <link rel="stylesheet" href="style.css" />
</head>

<body>

<header>
    <h1>F.E.N.S. (Flying Environment Of Nurturing Support)</h1>
    <nav>
        <a href="index.html">Home</a>
        <a href="about.html">About Us</a>
        <a href="app.html">App</a>
    </nav>
</header>

<section class="content">
    <h2>Welcome to the F.E.N.S. Alpha app!</h2>
    <p>Thank you for being part of the Alpha Version. This is a proof of concept and will be improved and worked on furthermore as we get interest of people like you! So if you like the idea or have any idea on how you'd like the direction to go, please let us know to help guide the development of this app! 
    Travel points are meant to be later-on transferred to travel benefits such as Expedia, Air Canada, Westjet, etc. But we need your help to make this a reality! Let us know what you'd like to see from the app, and share it with your friends to gain as many travel points as possible!</p>

    <iframe src="https://fenssafety.netlify.app"
            style="width:720px; height:1280px; border:none;"></iframe>
</section>

<footer>
    <p>Â© 2025 F.E.N.S.</p>
</footer>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
   const firebaseConfig = {
  apiKey: "AIzaSyAZHn8Lga62oU0tF-MVKDlIwfmrE_GsyfU",
  authDomain: "fens-map-van.firebaseapp.com",
  projectId: "fens-map-van",
  storageBucket: "fens-map-van.firebasestorage.app",
  messagingSenderId: "2995946455",
  appId: "1:2995946455:web:fb4ae8283463c4fadc8192",
  measurementId: "G-DZ471WS12V"

  // ðŸ”¥ JS function Unity can call
  window.saveDataFromUnity = function (collection, dataJson) {
    const data = JSON.parse(dataJson);

    db.collection(collection).add(data)
      .then(() => {
        console.log("Firestore write success");
      })
      .catch(err => {
        console.error("Firestore write error:", err);
      });
}; 

// Initialize Firebase
firebase.initializeApp(firebaseConfig);

// Initialize Firestore
const db = firebase.firestore();

</script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyAZHn8Lga62oU0tF-MVKDlIwfmrE_GsyfU",
    authDomain: "fens-map-van.firebaseapp.com",
    projectId: "fens-map-van"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  // ðŸ”´ THIS LINE IS THE KEY
  globalThis.fetchVancouverData_JS = async function () {
    try{
      const snapshot = await db.collection("Vancouver").get();
      

      let payload = {
      articles: "",
      firstUrl: "",
      secondUrl: "",
      thirdUrl: "",
      fourthUrl:""
      };

      snapshot.forEach(doc => {
        const d = doc.data();

        payload.articles = 
      `${d.First}\n\n` + 
      `${d.Second}\n\n` + 
      `${d.Third}\n\n` + 
      `${d.Fourth}`;

      payload.firstUrl = d.refFirst;
      payload.secondUrl = d.refSecond;
      payload.thirdUrl = d.refThird;
      payload.fourthUrl = d.refFourth;
      
      // payload = {
      //   articles: 
      //   `${d.First}\n\n` + 
      //   `${d.Second}\n\n` + 
      //   `${d.Third}\n\n` + 
      //   `${d.Fourth}`,
      //   firstUrl: d.refFirst,
      //   secondUrl: d.refSecond 
      
      //console.log(`Read data from firebase: ${JSON.stringify(payload)}`);

      //globalThis.sendDataToUnity(JSON.stringify(payload));
      //globalThis.sendData(JSON.stringify(payload));
    });

         // Send JSON back to Unity
      //const fullText = JSON.stringify(payload);
      const fullText = `${payload.articles} + ${payload.firstUrl} + ${payload.secondUrl}`;

      globalThis.unityInstance.SendMessage(
        "articleNews",
        "ReceiveVancouverData",
        //JSON.stringify(payload.articles) | JSON.stringify(payload.firstUrl) | JSON.stringify(payload.secondUrl)
        JSON.stringify(fullText)
      );

    } catch (e) {
      console.error("Firestore read error:", e);
    }

    // db.collection("emails").add({
    //   email: email,
    //   createdAt: firebase.firestore.FieldValue.serverTimestamp()
    // })
    // .then(() => console.log("Saved:", email))
    // .catch(e => console.error("Firestore error:", e));
  };
</script>

    <script src="Build/Final.loader.js"></script>
    <script>
      if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
        // Mobile device style: fill the whole browser client area with the game canvas:
        var meta = document.createElement('meta');
        meta.name = 'viewport';
        meta.content = 'width=device-width, height=device-height, initial-scale=1.0, user-scalable=no, shrink-to-fit=yes';
        document.getElementsByTagName('head')[0].appendChild(meta);

        var canvas = document.querySelector("#unity-canvas");
        canvas.style.width = "100%";
        canvas.style.height = "100%";
        canvas.style.position = "fixed";

        document.body.style.textAlign = "left";
      }

      createUnityInstance(document.querySelector("#unity-canvas"), {
        dataUrl: "Build/Final.data",
        frameworkUrl: "Build/Final.framework.js",
        codeUrl: "Build/Final.wasm",
        streamingAssetsUrl: "StreamingAssets",
        companyName: "FENS",
        productName: "SafeMap",
        productVersion: "1.0",
        // matchWebGLToCanvasSize: false, // Uncomment this to separately control WebGL canvas render size and DOM element size.
        // devicePixelRatio: 1, // Uncomment this to override low DPI rendering on high DPI displays.
      }).then((instance) => {
        globalThis.unityInstance = instance;
        console.log("Unity Instance ready");
      }).catch((err) => {
        console.error("Unity failed to load", err);
      });
    </script>

</body>
</html>
